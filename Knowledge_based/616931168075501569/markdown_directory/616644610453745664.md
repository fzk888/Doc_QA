**代码分支管理**

为了规范代码库分支管理和版本管理，使代码分支及版本结构清晰，方便维护，并避免由于维护造成的错误的版本发布等问题。

一、规范要求
============

1、 每个项目建立单独的GIT库。每个GIT库包括三条线长期分支，命名规则如下：

长期分支：

开发线（测试）：develop

生产线（正式）：master

发布版本（预发布）：release

不要在长期分支上直接提交代码，应通过短期分支代码合并到长期分支

短期分支：

功能分支：feature/xxxx

修复分支：hotfix/xxxx

2、开发及上线流程

  **阶段**   **分支**         **动作**                                 **执行人**
  ---------- ---------------- ---------------------------------------- ----------------
  开发       feature/hotfix   功能开发，提交代码                       开发人员
  测试       develop          合并测试的feature                        功能开发负责人
  预发布     release          合并上线的feature                        项目负责人
  发布       master           合并realse，添加tag，删除上线的feature   项目负责人

1)  项目负责人接到需求，划分并创建功能分支feature（需考虑业务依赖，关联性，完整性），feature分支需基于master创建。

2)  开发人员开发将代码提交到feature分支（根据个人习惯可以创建个人分支合并到feature分支）。

3)  开发完成提交测试时，由功能开发负责人发起feature合并到develop，并通过Jenkins更新测试环境，通知测试人员测试。

4)  测试完成上线前，需要测试人员通知xx功能上线，项目负责人基于master创建release分支，将需要上线的功能分支合并入release。

5)  项目负责人通过Jenkins自动更新release分支代码到测试环境，并通知测试进行预发布版本验证。

6)  如果测试人员验证通过则合并release到master分支，并删除feature分支和release分支；添加tag
    版本， 发布正式环境；通知发布更新及业务验证。

4、提交规范

提交分支时注明：动作类型（新增、修改、删除）+改动明细；

> 代码提交，需要写清楚本次提交内容，主体分为：类型，标题，内容，备注。
>
> 如：
>
> -fix：修复xxx功能，xxbug //类型：标题
>
> //空一行
>
> 由于线程池配置错误，导致任务阻塞不能及时处理，现将任务改成异步处理，并增加状态查询。//修改内容
>
> //空一行
>
> Close \#210314 //备注（bug编号）
>
> **类型：** 具体可以按照项目开发过程添加。

  名称       命名规则
  ---------- --------------------------
  feat       完成新功能
  fix        解决bug
  docs       文档变更
  refactor   重构代码
  perf       性能、页面优化
  test       增加测试用例、单元测试
  revert     回退版本
  build      打包
  chore      构建过程或辅助工具的变动

5、 生产环境由运维工程师将代码部署到服务器；

6、 禁止把跟项目无关文件上传到GIT库，如：框架文件等，仅上传代码；

二、Git分支管理
===============

1、长期分支
-----------

（1）主分支master : 存放的是随时可供在生产环境中部署的代码（Production
Ready state）。
当某一个开发测试活动结束之后，产生了一份新的可供部署的代码时，项目负责人将release分支代码合并入master分支。

关于master分支上的代码更新，除各端总负责人之外，任何人不得提交更新。更新完之后，每次发布打上Tag,如:
1.0.0

图片识别内容
Master
Tag
0.1
Tag
0.2
Tag
0.3


> （2）develop :
> 用于日常开发测试集成，存放最新的开发版代码，基于master合并入活跃的短期分支。
>
> （3）release：用于投入生产前的测试验证，通常基于master版本，将需要上线的feature和hotfix版本合并到该分支上；验证和测试周期较短，当验证完成后，需要合并到master；最终保证master和release代码一致

2、短期分支
-----------

### （1）feature分支

功能分支属于临时性分支,功能开发完成后删除。它是为了开发某种特定功能，从master分支上面分出来的。开发完成后，要再并入develop测试，测试中发现问题修改代码仍然在该分支进行修改，并合并develop继续测试，直至测试结束；

功能分支的名字，采用feature/\*的形式命名。

### （2）hotfix分支

软件正式发布以后，难免会出现bug。这时就需要创建一个分支，进行bug修复。

hotfix分支是从master分支上面分出来的。修补结束以后，再合并进master和develop分支。它的命名，可以采用hotfix-\*的形式。

三、命名规范
============

版本号规范
----------

版本号分为主版本号.次版本号.修订版本号。

如：

1.0.0：软件的初始版本。

1.1.0：向后兼容的新功能添加。

1.1.1：针对1.1.0的修复或安全补丁。

2.0.0：重大更新或重构，可能引入了新功能，同时也移除或修改了某些旧功能。

分支命名规范
------------

  分支类型     命名         说明
  ------------ ------------ ----------------------------------------
  主干         master       
  开发分支     develop      
  发布分支     release      预发布版本
  功能分支     feature/\*   使用带有含义的英文，禁止拼音，魔鬼数字
  hotfix分支   hotfix/\*    根据当前tag版本号增加，如：1.1.2

四、Git使用参考文档
===================

[[廖雪峰 Git
教程]{.underline}](https://www.liaoxuefeng.com/wiki/896043488029600)

[[git
工作流程]{.underline}](https://www.ruanyifeng.com/blog/2015/12/git-workflow.html)

[[Commit message 和 Change log
编写指南]{.underline}](https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html)

